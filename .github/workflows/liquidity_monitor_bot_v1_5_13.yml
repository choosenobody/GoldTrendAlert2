name: GoldTrendAlert Liquidity Monitor v1.5.13

on:
  workflow_dispatch:
  schedule:
    # GitHub Actions schedule uses UTC by default.
    # 21:00 Singapore Time (UTC+8) == 13:00 UTC
    - cron: "0 13 * * 1,3,5"   # Mon/Wed/Fri 21:00 SGT

jobs:
  run-liquidity-monitor:
    runs-on: ubuntu-latest
    timeout-minutes: 10

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.11"

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          python -m pip install requests

      - name: Run bot
        env:
          TELEGRAM_BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
          TELEGRAM_CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}
          FRED_API_KEY: ${{ secrets.FRED_API_KEY }}
          SOSOVALUE_API_KEY: ${{ secrets.SOSOVALUE_API_KEY }}

          BTC_ETF_FLOWS_CSV_URL: "https://raw.githubusercontent.com/choosenobody/GoldTrendAlert/main/.bot_state/btc_spot_etf_flows.csv"
          WGC_CSV_URL: "https://raw.githubusercontent.com/choosenobody/wgc_netbuy/main/.bot_state/wgc_netbuy.csv"

          # Insurance mode config (Plan 3)
          PLAN_MAX_GOLD_WEIGHT: "15.0"
          BASE_RATIO: "0.25"
          STARTER_POSITION_PCT: "0.75"
          WEEKLY_TOPUP_PCT: "0.75"
          ADD_TIGHT_PCT: "0.75"
          ADD_STD_PCT: "1.50"
          ADD_LOOSE_PCT: "1.50"
          # Optional: set current portfolio gold weight (%) for more precise actions
          # CURRENT_GOLD_WEIGHT: "0"

          FAIR_BAND_LOW: "3600"
          FAIR_BAND_HIGH: "4200"

          BUY_TRIGGER: "4100"
          BUY_BANDS: "3960-3920,3920-3850,3850-3780"
          TAKE_PROFIT_LEVELS: "4600,4850,5050"

        run: |
          python liquidity_monitor_bot_v1_5_13.py
