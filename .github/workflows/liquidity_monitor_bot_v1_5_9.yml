name: GoldTrendAlert Liquidity Monitor v1.5.9

on:
  workflow_dispatch:
  schedule:
    - cron: "0 */4 * * *"   # 每4小时一次（UTC）

jobs:
  run-liquidity-monitor:
    runs-on: ubuntu-latest
    timeout-minutes: 10

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.11"

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          python -m pip install requests

      - name: Run bot
        env:
          TELEGRAM_BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
          TELEGRAM_CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}

          # 建议用 Secrets；不配也可运行（脚本内有 FRED/SOSO fallback，但不建议长期这样做）
          FRED_API_KEY: ${{ secrets.FRED_API_KEY }}
          SOSOVALUE_API_KEY: ${{ secrets.SOSOVALUE_API_KEY }}

          BTC_ETF_FLOWS_CSV_URL: "https://raw.githubusercontent.com/choosenobody/GoldTrendAlert/main/.bot_state/btc_spot_etf_flows.csv"
          WGC_CSV_URL: "https://raw.githubusercontent.com/choosenobody/wgc_netbuy/main/.bot_state/wgc_netbuy.csv"

          ETF_LONG_D: "34"
          ETF_SHORT_D: "13"

          FAIR_BAND_LOW: "3600"
          FAIR_BAND_HIGH: "4200"

          PLAN_MAX_GOLD_WEIGHT: "18.0"
          BUY_TRIGGER: "4100"
          BUY_BANDS: "3960-3920,3920-3850,3850-3780"
          TAKE_PROFIT_LEVELS: "4600,4850,5050"

          # 可选：如果你填了，机器人会按你的“当前黄金仓位%”给出更具体的仓位纪律提示
          # CURRENT_GOLD_WEIGHT: "0"

          # 可选：未来你若补齐拍卖数据源，可传入 JSON，例如：
          # UST_AUCTIONS_DELTA: '{"last":2.43,"avg75d":2.43,"avg2y":2.48}'
          UST_AUCTIONS_DELTA: ""
        run: |
          python liquidity_monitor_bot_v1_5_9.py
